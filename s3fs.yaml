- name: download s3fs
  git:
    repo: https://github.com/s3fs-fuse/s3fs-fuse.git
    dest: /home/alex/code/s3fs-fuse
  become: yes
  become_user: alex
- name: install s3fs prereqs (redhat)
  package:
    name:
      - automake
      - fuse
      - fuse-devel
      - gcc-c++
      - git
      - libcurl-devel
      - libxml2-devel
      - make
      - openssl-devel
    state: present
  become: yes
  when: ansible_os_family == 'RedHat'
- name: install s3fs prereqs (debian)
  package:
    name:
      - automake
      - autotools-dev
      - fuse
      - g++
      - git
      - libcurl4-openssl-dev
      - libfuse-dev
      - libssl-dev
      - libxml2-dev
      - make
      - pkg-config
    state: present
  become: yes
  when: ansible_os_family == 'Debian'
- name: compile s3fs
  command: "{{ item }}"
  with_items:
    - ./autogen.sh
    - ./configure
    - make
  args:
    chdir: /home/alex/code/s3fs-fuse
    creates: /home/alex/code/s3fs-fuse/src/s3fs
  become: yes
  become_user: alex
- name: install s3fs
  command: make install
  args:
    chdir: /home/alex/code/s3fs-fuse
    creates: /usr/local/bin/s3fs
  become: yes
